_______________________________________________________________________________
Комплекс Мониторинга Качества Углей
О продукте:      http://www.kometalab.com.ua/products/mku/

_______________________________________________________________________________
Описание файла io.cqm.
Автор: Руслан Кеба.
______________________________________________________________________________

1. ОБЩИЕ ПОЛОЖЕНИЯ.

Файл io.cqm описывает используемые устройства ввода/вывода и сигналы.
Ссылка на него находится в ини для Сервера:

  [core]
  ;конфигурация ввода/вывода
  ioconffile=io.cqm

Этот файл читает ядро (core) как входной поток.
Информативная часть файла начинается после слова start
и заканчивается словом end.
Допустимы комментарии; это строка начинающаяся с символа '#'.
Структура файла:

  start [имя конфигурации]
    devices
      item ...
      item ...
      ...
    end
    signals
      item ...
      item ...
      ...
    end
  end

Файл разбит на две секции, каждая из которых описывает одинаковые сущности:
  devices         - устройства ввода/вывода;
  signals         - сигналы;

Каждая секция после описания сущностей заканчивается словом end.
Описание каждой сущности начинается словом item. Например:

  devices
    item ...
    item ...
  end

Первой всегда должна описываться секция устройств (devices),
а затем секция сигналов (signals).

_______________________________________________________________________________

2. УСТРОЙСТВА.

Устройсва ввода/вывода описываются в секции devices.

  devices
    item <класс> <модель> <имя>
         <базовый адрес> <IRQ> <канал DMA>
    ...
  end

где

  <класс>         - уникальный идентификатор модели (см. ниже);
  <модель>        - название модели устройства (формальность);
  <имя>           - слово из латинских букв, идентифицирующее устройство
                    для дальнейших ссылок на него;
  <базовый адрес> - десятичное число в допустимом диапазоне
                    адресов ввода/вывода;
  <IRQ>           - 0 (пока не используется);
  <канал DMA>     - 0 (пока не используется).

Идентификаторы моделей устройств (классы).

    #      ТИП                         ПРИМЕЧАНИЕ
    0      DEVICE_UNKNOWN              не используется
    1      DEVICE_PCL836               не используется
   65      DEVICE_PCL836_COUNTERS_IN   частотный ввод (счётчик) на pcl836
   66      DEVICE_A10_COUNTERS_IN      частотный ввод (счётчик) на a10
  129      DEVICE_PCL836_DISCRETE_IN   дискретный ввод на pcl836
  130      DEVICE_A10_DISCRETE_IN      дискретный ввод на a10

_______________________________________________________________________________

3. СИГНАЛЫ.

Используемые в системе сигналы описываются в секции signals.

  signals
    item <класс> <метод> <имя> <титульное название>
         <устройство> <смещение> <бит> <инверсия>
         <активность> <значение по умолчанию>
    ...
  end

где

  <класс>              - идентификатор класса сигнала (см. ниже);
  <метод>              - идентификатор метода для обработки сигнала (см. ниже);
  <имя>                - слово из латинских букв, которое однозначно
                         идентифицирует сигнал для ссылок на него;
  <титульное название> - имя, которое используется при выводе debug-сообщений;
  <устройство>         - имя устройства, с помощью которого
                         сигнал обрабатывается;
  <смещение>           - десятичное число, смещение относительно базового
                         адреса устройства или номер канала ввода/выода;
  <бит>                - номер бита в байте [0..7] для дискретных сигналов,
                         номер счётчика для частотного;
  <инверсия>           - 0 = остаётся как есть, 1 = инвертируется;
  <активность>         - 0 = применяется значение по умолчанию,
                         1 = обрабатывается с помощью устройства ввода/выода;
  <значение по умолчанию> - значение сигнала, если он неактивный.

Идентификаторы классов сигналов:

    #      ТИП                         ПРИМЕЧАНИЕ
    0      SIGNAL_NONE                 не используется
   65      SIGNAL_FREQ                 обобщенный частотный, не используется
   66      SIGNAL_FREQ_836             частотный сигнал на pcl836
   67      SIGNAL_FREQ_A10             частотный сигнал на a10
  129      SIGNAL_DISCRETE             дискретный ввод

Эти идентификаторы - числа в диапазоне [0.255], т.е. 8 бит.
Девятый бит используется для признака клиентского сигнала, т.е. сигнала
который будет индицироваться на панели в Клиенте.

Метод обработки сигналов даёт результат за n интервалов измерения
сигналов (результат сигнала за минуту по данным двухсекундных значений).
Идентификаторы методов обработки сигналов:

    #      ТИП            ПРИМЕЧАНИЕ
    0      METHOD_NONE    результат всегда 0;
  129      METHOD_WAS_0   результат 0, если хотя бы один раз было значение 0, иначе 1;
  130      METHOD_WAS_1   результат 1, если хотя бы один раз было значение 1, иначе 0;
  131      METHOD_MAJOR   результат 1, если значений 1 было >= чем значений 0, иначе 0.
  132      METHOD_5ZEROS  результат 1, если последовательно 5 или больше раз был 0, иначе 0.

Такие методы используются для дискретных сигналов.
Например, для сигнала power (наличие контроля питания) метод 132 даст
результат 1, если было отключение питания больше чем на 10 секунд
(при тике системы 2 секунды).

_______________________________________________________________________________
© 2002-2004          Комета
  сайт:          www.kometalab.com.ua
  эл. почта: mailbox@kometalab.com.ua
