_______________________________________________________________________________
Прораммное обеспечение комплекса МКУ.

_______________________________________________________________________________
TODO 3.x
[х] Firebird вместо MySql.
[ ] Новый cqml2 для простоты контроля передаваемых данных и ошибок.
[ ] Отдельный сервер ввода-вывода iogage.



_______________________________________________________________________________
Версия  3.0.3.production
Начало: 31.08.2007
Конец:  18.10.2007, 05.02.2008

+ [2.2.16] [Сервер] Аргумент для командной строки -noio: запуск сервера без проверки
  драйвера ввода/вывода. (Для Глузмана на Висте)
* [Клиент] Автоматическое скрытие панели с текущей зольностью и диагностикой
  если работаем без сервера (!isserver).  
* [Клиент] Сохранялись в ини пустые клиентские данные при ошибке их полчения.
+ [Клиент] Выдача сообщений при невозможности получить клиентские данные.
+ [2.2.15] [Клиент] Расчёт зольности и веса для маршрута за любой интевал времени в отчётах.
  Для Благодатной.
+ cqm2bios.py - экспорт вагонов в dbf-файл для биос на Питоне
+ [Клиент] Перед работой Клиент проверяет запросом "perm" разрешение работать с сервером
  Для контроля количества подключенных клиентов (на сташкова - 2 max)
  

_______________________________________________________________________________
Версия  3.0.2.production
Начало: 06.06.2006
Конец:  06.09.2006

* [2.2.14] [Клиент] Увеличено поле для номера и названия позиции в удостоверении,
  (для Лены со Сташкова).
* [2.2.14] [Клиент] Правильная печать удостоверения с несколькими позициями - без номера
  и названия позиции. (Для Аллы Степановны).
* Отказ от использвания #define CQM_SERVER_APPLICATION. Определение имён логов
  теперь через extern AnsiString LogName; содержимое которого определяется в
  cqmsrv.cpp и cqmcli.cpp. И теперь global.obj не зависит от того, где
  был собран. Собирать можно не только make, но и build.
* [2.2.13] [Клиент] Сохранение в ини клиентских данных сразу после их
  получения (было при завершении работы).
* [2.2.13] [Клиент, Сервер] Проверка наличия ини-файла перед его загрузкой.
* [2.2.13] В деструкторе формы журнала перед удалением буфера и лог-файла делаем сброс 
  буфера.
* [Сервер] Приглашение ввода пароля для работы автоматически убирается
  после минуты ожидания.
* [Клиент] При установке новых значений накоптеля число интервалов
  устанавливается автоматически (вес/10).
* [Клиент] Окно `аккумуляторы` теперь называется `накопители`.

_______________________________________________________________________________
Версия  3.0.1.beta rc1
Начало: 17.05.2006
Конец:  28.05.2006

! Начало эксплуатации на объекте dnepr.
* [Клиент] Небольшие изменения размеров в удостоверении.
* [Клиент] ZReadOnlyQuery qcoalranks вместо ZTable tcoalranks в редакторе
  вагонов для Lookup-поля марки угля. Марка id=0 '*' не отображается.
* [Клиент] Ошибка округления в итоговых значениях повагонного отчёта.
* [Ядро] В классе CqmVagonTipper при нажатии кв весь уголь записывается в вагон
  до кв, следующий всегда остаётся пустой вне зависимости от момента в минуте
  нажатия кв.
* Клиент работает с бд теперь от имени пользователя client, сервер - server,
  всё остальное - sysdba, распределены права на доступ к объектам бд.
* Новые пользователи для fb: sysdba:boss1, server:srv1, client:cli1.

_______________________________________________________________________________
Версия  3.0.0.rc1
Начало: 28.03.2006
Конец:  03.04.2006

* [2.2.11] [Сервер] В CqmAlgorithm::MakeAvgFA2 неправильная обработка 
  для стоячего конвейера, нашли и правили на Павлоградской.
* [2.2.11] [Клиент] TCustomAshGraphF::GetCurrentAsh - парсинг ответов сервера через
  sscanf вместо std::strstream.
* [Клиент] Форматирование %.1f полей a, p, w в повагонном отчёте.
* [Клиент] Ошибка в LastInsertId (буд-то для mysql).

_______________________________________________________________________________
Версия  3.0.0-alpha
Начало: 17.02.2006
Конец:  24.03.2006
Цель:   [ ] Конвертер бд из mysql в fb.
        [x] Чистка старого кода (#define FIREBIRD15).
        [ ] Попробывать почистить zeos components от лишнего.
            Тестирование.

* [2.2.11] В алгоритме в второй чистке учитывались лишние частоты
  стоячего конвейера.
+ [Клиент] Обновление bitmap в окне сигналов только, если значение
  сигнала изменилось.
+ Ежедневное удаление бэкапов бд, которые старше 60 дней.
+ [2.2.10] Экономное (по размеру) форматирование логов сервера.
* Изменение вида запроса в get_smooth_ash (отказ от много cast и 
  использование udf) дало уменьшение времени его выполнения в 20 раз.
* В кусочки нарезанные из большого лога сигналов добавляется заголовок 
  с именами сигналов.
* [2.2.10] [Сервер] В редакторе таблиц фильтр по времени 'все' означал не страше
  400 дней. Владимир Иосифович долго искал старые записи на Благодатной.
* [Клиент] Невидимость позиции по умолчанию в редакторе позиций.
* [Клиент] Форматирование окне минутных значений.
* При перезапуске сервера вызываем cqmstart.cmd
+ Проверка в реестре значения текушей shell и установка is_nShell.
* Везде сравнения времен с cast переделал на addhour/addday.
- #define FIREBIRD15 убрал. Теперь нет обратной совместимости с mysql.
- CheckDBIntegrity убрал, теперь это делается в cqmstart.cmd

_______________________________________________________________________________
Версия  2.5-develop
Начало: 26.12.2005
Конец:  15.02.2006
Цель:   [x] Переход на firebird 1.5.
        [~] CheckDBIntegriry для fb.

+ Новая система запуска cqmstart.cmd (проверка бд+запуск сервера+запуск клиента)
+ Отдельное назначеное задание для резервирования бд, каждые 12 часов.
+ Новая система резервирования базы данных (fbbu+dbservice)
* Скрипты cphp вместо php, инсталятор лёгкого php 5.1.
+ Новая система инсталляции.
+ Инсталлятор для МКУ Инструменты (tools)
+ Новая структура каталогов в исходниках и инсталляции.
+ Месячный отчёт по позициям.
! rpos.cpp полностью переписан.
! fcteditor.cpp не использует #ifdef FIREBIRD15, а полностью переписан для него.
* #define NO_COALTYPE 0 вместо -1.
+ #define FIREBIRD15 Условная компиляция.

_______________________________________________________________________________
Версия  2.2.9-develop
Начало: 16.12.2005 11:19:39
Конец:  22.12.2005 10:18:21

* В таблице calibrations поле val преобразовано в float из varchar.
  При инсталляции после развёртывания бд запускается alter1.sql, который
  делает эти изменения.
+ [Сервер] Выбор метода выключения (off) при отключении питания: в ини
  defaultoffmethod=5 (по умолчанию POWEROFF), для Змиевского компа нужно 3 (HALT).
* Установка DecimalSeparator = '.' (разделитель целой и дробной части, фича vcl)
  по умолчанию для Сервера и Клиента. Игнорируются Региональные настройки.


_______________________________________________________________________________
Версия  2.2.8-alpha
Начало: 02.11.2005 11:28:34
Конец:  05.12.2005 14:06:09
Цель:   [x] возможность работы Клиента без Сервера.
        [x] корректный запуск Сервера из Клиента.
        [ ] система автоматической установки проекта выбранного
            объекта, автоматическое развёртывание базы данных.
        [x] интерфейс для методиста в scilab.

* [Клиент] Правильная строка 'итого' в отчёте по позициям.
* [Клиент] Правильное форматирование влажности и их веса в таблице вагонов.
* [Сервер] При переходе из таблицы в таблицу не обнулялся WHERE-фильтр
   и навигация по таблицам становилась невозможной.
* Сжатие логов сервера и клиента: limitdate=1 вместо 0 (сжимались и
  перемещались все, а теперь старше суток).
* [Сервер] OFF_HALT вместо OFF_POWEROFF при оключении питания.
* [Сервер] Максимальное количество сигналов увеличено с 32 до 64
  для работы с двумя платами a10.
+ [Клиент] Запуск Клиента без Сервера - в ини isserver=0 или
  параметр в командной строке с -noserver.
+ [Клиент] Аргумент в командной строке -noserver, который устанавливает
  isserver в false независимо от ини.
+ [Клиент] Добавлен парсинг командной строки (функция ReadArgs()).
+ [Клиент] Добавлен в программу и в ини isserver - признак того, работает
  Клиент с Сервером или без него.
- [Клиент] Удалены из ини и из программы checkserver, remoteserver

_______________________________________________________________________________
Версия  2.2.7-stable
Начало: 11.07.2005 12:48:30
Конец:  12.09.2005 16:05:07
Цель:

+ [Клиент] В отчёте по позициям строка "итого" только для позиций с
  несколькими удостоверений.
+ [Клиент] Название позиции в отчёте по позициям, новое форматирование отчёта.
+ [Клиент] Посмотреть ВСЕ вагоны, без фильтра по времени.
+ [Клиент] Свой LocateVagon вместо родного (неработающего) TZQuery::Locate.
  Теперь при ежеминутном обновлении курсор в гриде не убегает постоянно вниз.
* [Клиент] Ширина полей в окне вагонов меньше (для разрешения 800*600).
* [Клиент] Ширина полей в отчёте по позициям для шести цифр.
+ [Клиент] Возможность сглаживать графики точек и маршрутов в отчётах.
* [Клиент] Меньший Zoom для начального вида превью отчёта перед печатью
  (для разрешения 800*600).
+ [Плоттер] Немного переделан интерфейс - появилось главное меню,
  Возможность построить 4 серии, удалить последнюю серию, построить
  с масштабным коэффициентом.
+ [Клиент] На рабочем графике возможность скользить по 6 значениям.
* [Клиент] Чуть другое расположение на окне индикации сигналов.

_______________________________________________________________________________
Версия  2.2.6-gamma
Начало: 06.06.2005 12:38:23
Конец:  11.07.2005 12:48:05
Цель:   Адаптация ПО для работы с Инфоцентром МКУ.
        (Y) [Клиент] Месячный отчёт.
        (Y) Деление логов на файлы меньших размеров.

+ Директория \tools с утилитками для МКУ.
* Изменения для нормальной работы с сервером из telnet-клиента.
+ [Клиент] Добавлен 3-х дневный интервал в окне минутных значений.
* Изменён стиль окна "Про МКУ".
+ ReadClientData(char*) для возможности запуска из ИЦ.
* [ini] sqlmonitor в секцию connection.
+ define CQM_CLIENT_APPLICATION для возможности отличить компиляцию для cqmic.
* [Клиент] Размеры шрифтов в удостоверении (для Кузнецовой).
+ Ежедневно все логи Сервера и Клиента gzip-уются и сохраняются
  в c:\backup\server и c:\backup\client.
+ [logfile.h] После достижения log-файлом заданного размера (3000000 байт),
  текущий файл закрывается и создаётся новый.
+ [Клиент] Месячный отчёт по точкам контроля и маршрутам.

_______________________________________________________________________________
Версия  2.2.5-gamma
Начало: 30.05.2005 17:29:49
Конец:  06.06.2005 12:37:44
Цель:   (Y) [Клиент] Не использовать ZTable в окне вагонов.
        (Y) [Сервер] Не использовать ZTable в TableViewer.
        (N) Аварийная сигнализация работает только текущую
            минуту, потом опять проверяется код диагоностики.
        (Y) Активизация Sql-монитора из ини для Клиента и Сервера.

* [Клиент] В редакторе позиций сортировка по номеру позиции.
* [Сервер] TableViewer: ZQuery с RequestLive вместо ZTable = при открытии
  Dataset захват не всей таблицы, а по запросу с фильтром WHERE.
+ SqlMonitor; его активность определяется в ini.
* [Клиент] Редактор вагонов: ZQuery с RequestLive вместо ZTable = при открытии
  Dataset захват не всей таблицы, а по запросу с фильтром WHERE.

_______________________________________________________________________________
Версия  2.2.4-stable
Начало: 12.04.2005 10:54:46
Конец:
Цель:   (Y) Не удалять логи после деинсталляции, а сжимать и сохранять
             где-нибудь в c:\backup\logs\*.gz.

* Неправильное определение active для точки контроля (целочисленное деление:).
* [Клиент] Чутка другое оформление окна аккумуляторов.
* [Сервер] Нельзя свернуть окно редактора позиций.
+ [Клиент] Запись в журнал при вставке вагонов и партий.
+ [Клиент] Чутка другое оформление окна маршрутов.
+ tools\lsm - консольная программа рассчёта по методу наименьших квадратов.
+ tools\ashwei - расчёт среднавзвешенной зольности (проект на c++ в gcc).
+ tools\cqmdiag - преобразование кода диагностики в текст (проект на c++ в gcc).
+ Директория tools для инструментов.
* Русские сокращение БДН и БДЗ вместо БДP, БДA в cqmdiag.cpp.
* [Сервер] Ускорение загрузки за счёт открытия таблицы по-умолчанию
  calibration вместо points.
+ Еженедельно и при деинсталляции логи Клиента, Сервера и сигналов gzipуются
  и перемещаются в c:\backup\client\logs, c:\backup\server\logs,
  c:\backup\server\signals соответственно.
* [Клиент] Ошибка при получении Amin, Amax из ини для графиков точкт контроля.
* [Клиент] Багфикс в TCustomAshGraphF::Refresh(): сигнализация диагностики
  после неудачной интерпретации ответа Сервера.
+ [Сервер] Больший размер главного окна после восстановления.
+ apause.exe для читаемости текста "МКУ СЕРВЕР УЖЕ РАБОТАЕТ" в консоле.
+ Автоматическая перезагрузка после недели работы;
  происходит только в первом часу ночи.
+ Работа с оболочкой noshell: ключ noshell=1 в cqmsrv.ini.

_______________________________________________________________________________
Версия  2.2.3
Начало: 29.03.2005 18:34:33
Конец:  12.04.2005 10:54:15
Цель:   (Y) Исправить текущие ошибки, возникшие на ТЭС,
            ошибки на Сташкова.

Баги:   (Y) Нет всех линий в отчётах.
        (Y) Мелкие буквы в удостоверениях.
        (Y) Неверный поряд сортировки в отчёте по позициям.
        (Y) Ошибка при установке значений аккумулятора.
        (Y) В удостоверение попадают вагоны за прошлый год.
        (N) Пустые поля в удостоверении для заполнения всей формы.

* [Клиент] В отчёте почасовом итог за смену после соответствующих часовок.
* [Клиент] В удостоверение попадают вагоны только за этот год.
* [Клиент] Пункты Меню Отчёты - Удостоверение - Внутренняя сторона на бланке
  и ... - Внутренняя сторона на пустой странице вместо переключателя.
* [Клиент] Удалён из ини параметр CertForBlank.
* [Клиент] Все линии в отчетах.
* [Клиент] Правильный порядок сортировки в отчёте по позициям.
* При установке значений для аккумулятора использование CoalHeap::setPa().
_______________________________________________________________________________
Версия  2.2.2-rc2
Начало: 17.02.2005 18:16:39
Конец:  29.03.2005 18:34:29
Цель:   ( ) подготовить к работе на ТЭС.

Баги:   ( ) ошибка в addAsh после угля без зольности.
        ( ) Kick от нити в/в после остановки ядра.

+ Создание sql.gz-слепка базы данных во время создания инсталяции, ложится
  в mku\backup\good\.
* [Клиент] В Редакторе вагонов Ctrl+D для заполнения даты ж/д суток текущей
  календарной датой.
* Тестовый вариант addAsh с отдельным весом для рассчёта средневзв. зольности.
* [Клиент] Показывать текст диагностики после Scroll в окне минутного архива.

_______________________________________________________________________________
Версия  2.2.2-rc1
Начало: 10.02.2005 11:50:53
Конец:  15.02.2005 11:28:29
Цель:   (Y) исправить известные ошибки, подготовить к установкам;
        (Y) в отчётах почасовых если время работы 1 мин. (что наверно после
            dbpacker.php) время работы не выводить.
        (Y) График зольности для маршрутов.

Баги:   (Y) неполное выполнение sql в magula;
        (Y) зависание Клиента при создании форм;
        (Y) большое использование памяти Сервером - 2 недели ~ 50Mb;
        (Y) неверное значени веса и зольности после прохождения очереди;
        (Y) ошибка в датах в dbpacker.php.

* [Клиент] В почасовом отчёте выборочный вывод времени работы (устранение
  результатов работы dbpacker.php).
+ [Клиент] График зольности маршрута.
* Изменения определения траффика: вместо родительской точки контроля,
  определяются родительский конвейер и источник угля.
* (!!!!!) При расчёте кусочка угля для очереди нужно делить на conv_worked
  вместо dataCount.
* Переделка CqmCoalQueue для работы с CoalQueue.
+ Класс CoalQueue вместо queue<Coal>.
* Переделка небольшая cqmcompute::stop().
* Неопределённое стартовое значение entityCount.
* Magula 1.2.0 - снято ограничение в 2Mb на размер распакованного файла.
* Неправильное формирование выборки в dbpacker.php.

_______________________________________________________________________________
Версия  2.2.1-develop
Начало: 20.01.2005 08:01:29
Конец:  10.02.2005 11:50:18
Цель:   (Y) Сущности для аккумулятора,
        (Y) отрицательные сущности для маршрута,
        (Y) диагностика "Источник" при анализе FA с учётом FP,
        (N) точное определение active для маршрута,
        (N) значения сигналов в функциях при расчёте маршрутов,
        (Y) исправить неверное значение веса и зольности после прохождения очереди,
        (Y) внешние подключаемые модули к ядру,
        (Y) отметки зольности вагонов на графиках клиента.

* [Клиент] Получение влажности из договора на форме добавления партии вагонов.
* [Клиент] Ошибки zeos-компонентов в редакторе типов углей.
* [Клиент] Правильный TabOrder на форме добавления/правки партии вагонов.
* Добавление во время инсталляции пользователя mysql root@192.168.6.%
  с паролем и полным набором прав.
* Удалены проверки налиция датчика нагрузки: считается, что он всегда
  присутствует и BDP=1.
* [Сервер] При смене таблицв в TableViewer нужно SortedFields="".
* Активность точки контроля рассчитывается в алгоритме P->active = mpn/n.
+ [Клиент] Значения зольности вагонов на графике точки контроля; выбор вагонов
  через VagonId в секции AshGraph-x ини Клиента.
* Минимальный размер очереди 0 -- работа напролёт.
+ Сущности для аккумулятора.
+ Расширение для blagodat c116c.dll.
+ Коды возврата работы расширений в cqmextension_def.h.
+ Возможность вычитания сущностей при расчёте маршрута -- разделитель
  сущностей '-'.
+ Запуск назначенных заданий, свёрнутых в системный трэй.
+ Сущность CqmExtension, реализующая загрузку внешних расширений
  (dll для Windows) и выполнение его процедур, которым передаётся
  указатель на core.
+ Tester.exe: программа для теста dll-расширений.
* [Клиент] Timer на MainF включается в InitForms, а не при создании формы;
  мог срабатывать до завершения StartActions.
* Новая система определения версий (cqmversion.h, .cpp). Нет отдельно версии
  ядра (cqmcorev.h).

_______________________________________________________________________________
Версия  2.2.0-alpha
Начало: 09.01.2005 14:45:26
Конец:  20.01.2005 07:54:16
Цель:   Переход на Borland C++ Builder 6 Pro.

* удаление именно выбранного вагона в редакторе вагонов после ежеминутного
  обновления (был переход на последний и его удаление).
+ Рестарт сервера из главного меню сервера и командой off restart.
* Без STRICT_DLL_LOADING в Zeos.inc для загрузки libmysql.dll,
  а не libmysql323.dll.
+ Лог выполнения назначенных заданий в mku\sys\scripts\_logs\.
* /interactive назначенные задания.
* Application->MessageBox вместо MessageBox(NULL, ...), что приводило
  к появлению немодального окна без родителя.
+ [Ядро] Переменная eov -- Количество предыдущих регистраций КВ, при котором
  совместно с текущим значением КВ=1, регистрируется КВ. Исправлены все
  сущности вагонов.
* Много мелких исправлений для новых zeos-компонентов.
* [Сервер] DisplayFormat="0.0" для всех float-полей в TableViewer для
  нормального отбражения чисел (а не 1.499999998400756 ~ 1.5!).
- [Сервер] Удалены в меню Окна пункты Позиции, Типы углей и Марки углей.
  Доступ к этим таблицам через Редактор типов углей.
* Иконка вместо bmp в форме "О Программе" (ProMKU).
+ Переход на среду разработки C++ Builder 6.0 Pro.
* Проект CqmUtil удалён из группы проектов cqm и выделен
  в самостоятельный проект plotter.

_______________________________________________________________________________
25.11.2004 15:42:14 Версия 2.1.5

ЯДРО:
* Установка в 0 значение argCount в классе CqmVagonQueue при инициализации.
+ Безусловная коррекция значений частоты по времени её измерения.
* Правильный рассчёт active для Маршрута.
* Отвержение запросов к ядру, когда оно остановлена нить в\в.
+ Возможность суммировать в маршрутах не только траффики, но и любые сущности.
+ Параметр active для CqmEntity. (он был у CqmRoute, вместо dn у CqmTraffic).
* Очень большие допуски для параметров Coal, при этом значимые значения
  веса обнулялись.
* Ошибка в debug-сообщениях от CoalQueue.
* Ошибка в рассчёте траффиков с функцией fuone(), при которой dn получалось
  больше 1.
+ Правильное создание в Start и удаление в Stop динамических объектов
  в сущностях.
+ Новый класс вагонов CqmVagonQueue, который питается от очереди.
+ Новая сущность CqmCoalQueue - очередь для реализации задержек
  на длинных конвейерах.
+ Новое форматирование сообщений от сущностей.

СЕРВЕР:
+ tpTimeCritical приоритет для нити в/в.
  Даёт стабилицазию работы таймера - ошибка 0.1%.
+ Если в ини не обнуражен CID, он ищется в файле WinDir\cid.key,
  туда его записывает KeyGen.exe.
* SetFocus в предыдущем bugfix лишний, теряет фокус TableViewer.
+ В журнале: он невидим когда в него выводят многострочное сообщение для
  ускорения работы на медленных компах. Потом SetFocus и WM_VSCROLL SB_BOTTOM.

КЛИЕНТ:
* Для всех видов отчётов форматирование значений веса и зольности "%3.1f".
+ Отчёт по интервалам работы маршрутов; настройка времени суток и смен из ини.
_______________________________________________________________________________
16.09.2004 18:03:19 Версия 2.1.4

ЯДРО: Версия 1.0.4
+ Активность маршрута (веса нет, но там что-то идёт, точно
  нельзя определить что).
- Классы точек контроля 002 и 102.
* не обнулял кучу для вагона, когда делал addvagon.
* ошибка в getpoint.
+ Команда CQML: showvars - возвращает все переменные ядра и их значения.
+ Команды CQML: core:set variable value и core:get variable.
+ Переменные ядра и доступ к ним через double core.vd("name") и int
  int core.vi("name").
- Переменная core.debug.
+ Отслеживние исключений на этапах загрузки и старта ядра.
+ MakeCoaltypeOrder - последовательность вызова MakeCoaltype для сущностей;
  регулируется из points.cqm.
+ Класс CqmVagonTipper - вагоны на вагоноопрокиде.
+ Новый extern-функции для ядра: getvagoncoaltype, firstemptyvagon,
  solvecoaltype4.
+ Абстрактный класс CqmCustomVagon - предок для всех остальных вагонов.
+ void getCoaltype() для CqmEntity.
+ void getCoal() для CqmEntity.
+ what_coaltype - у кого или как брат тип угля для сущности:
    <число> - задан;
    <SELF>  - считает сам (вагоноопрокид, маршрут из суммы траффиков);
    <имя сущности> - брать у этой сущности через getCoaltype.
+ coaltype для аккумуляторов (и в базе данных).

СЕРВЕР:
+ кнопка post для грида типов углей в редакторе типов улей.
+ время ожидания старта нити в/в, в ини iothrstarttimeout=1000.
+ контроль питания с помощью метода 132 для сигнала power.
+ метод 132 для анализа сигналов:  раз подряд 0 вернёт 1.
+ Заголовок с названиями сигналов в окне Сигналов.
+ Редактор типов углей.
* SetFocus для окна MsgsF, если при вызове DoFlushBuf, окно имело фокус.
* Переполнение буфера debugstr портило хэндлы объектов синхронизации.
+ Новая система отслеживания имключительных ситуаций,
  в частности при работе с WinAPI.
* Устанавливается Active для объектов TLogFile, если файл успешно открыт.
  Раньше - значение по какому-то умолчанию???!!!
+ Beep в отдельной нити.
+ Courier New в окне Журнала.

КЛИЕНТ:
+ Галочка "Больше не показывать" в окне Аварийной сигнализации,
  не сигнализирует десять минут.
+ Удаление вагона в редакторе вагонов без подтверждения, если нажата Shift.
+ LookUp для Марки угля в редакторе вагонов.
+ Аварийная звуковая и световая сигнализация.
* Неправильная интерпретация ответа сервера в окне Аккумуляторов.

УТИЛИТА:
- Работа с базой данных: упаковка.
- Удаление старых логов.

PHP:
+ Работа с базой данных: упаковка.
+ Удаление старых логов.

ИНСТАЛЛЯЦИЯ:
+ Немного изменённая структура mku\sys.
- utilsdb.
+ magula.


_______________________________________________________________________________
29.08.2004 11:40:50 Версия 2.1.3
СЕРВЕР:

ЯДРО:
+ Стандартный интерфейс всех методов для всех сущностей.
+ Ноый класс CqmEntity - предок всех cqm-сущностей.
+ Статус отладки ядра 1 - алгорити,
                      2 - сущности,
                      3 - ввод/вывод.
+ Размер аккумулятора. Работает если >0. Больший вес приравнивает размеру.

БАЗА ДАННЫХ:
- параметр debug.

КЛИЕНТ:
+ если в ини certface="", то меню "Отчёты" подменю "Удостоверение" не появится.
- метод SavePosition из классов форм с параметрами размещения в ини.
+ общий глобальный ини файл через TMemIniFile * ini; постоянно хранится
  в памяти.

ИНСТАЛЛЯЦИЯ:
- Сервер MySql убран из инсталляции, должен устанавливаться отдельно.

_______________________________________________________________________________
13.07.2004 08:51:08 Версия 2.1.2
СЕРВЕР:
+ doSqlFilter = true для TZMysqlTable, что бы таблицы делали
  фильтры уже в запросе.
+ HIGH_SECURITY - возможность зашить в билд cid и даты, до которой сервер
  будет запускаться.

ЯДРО:
+ CORE_DEBUG_LEVEL_HW - уровень отладки в/в ядра.

КЛИЕНТ:
* Отчёт по позициям без влажности, марки и теплоты. Выбор из ини.
+ При поиске в вагонах делаем DisableControls.
+ doSqlFilter = true для TZMysqlTable, что бы таблицы делали
  фильтры уже в запросе.

_______________________________________________________________________________
04.06.2004 10:55:29 Версия 2.1.1
СЕРВЕР:
* При общении через сокет в логах пишутся только неудачные комады.
- Наследники от FTableViewer.
+ Просмотр всех таблиц с помощью одной формы TableViewer.
+ Не пишем в таблицы points, routes когда "простой".

ЯДРО: Версия 1.0.3
* Новые методы addCoal, subCoal. Учёт влажности в них.
* Новая структура заголовочных файлов ядра. core теперь можна увидеть
  из любого файла или класса.
+ Новая сущность: CqmFunction.
+ Новая сущность: CqmTraffic.
+ Новая сущность: CqmRoute.
+ Новая сущность: CqmAccum (аккумуляторы).
+ Класс CoalParameter: общий предок для Ash, Weight, Humidity.
+ Новый форматированный вывод в CoalParameter, Coal и CoalHeap.
+ Возможность писать комментарии в cqm-файлах. Это целые строки, которые
  начинаются с '#'.
+ autoexec-команды для ядра.
+ Маскирование типа сигналов для возможности разделить его класс (дискр_a10,
  частотный_836) и тип (клиентский).
+ Титульное название сигнала (title).
+ Функции cqmstreamparse для парсинга входных потоков (cqm-фалов).
+ Метод GetPointId в классе Compute вместо FindParentControlPoint в классах
  вагонах.
+ Методы GetFunctionId, GetTrafficId, GetRouteId в классе Compute.
+ Уровень отладки ядра core.debug.

КЛИЕНТ:
+ Имя обьекта на отчётах.
+ Форма Помощник оператора погрузки создаётся динамически.
+ Получение ини-информации об индицируемых сигналах через
  CqmNet (core: getclientdata).
+ В ини для окон: График зольности, Обзор вагонов и Редактор вагонов
  указываем не имя родителя (например, AshGraph-conv20), а только
  номер родителя (AshGraph-0).
+ Новые суточные отчёты.
+ Текущие значения зольности и диагностики для AshGraph через CqmNet.
- Локальные клиентские данные.
* Изменения в отчётах по вагонам и по позициям: влажность, теплота.
+ Работа с партиями вагонов (вставить, изменить).
+ Свой Просмотрщик отчётов вместо стандартного.

CQML:
+ Много новых запросов. см. doc\cqml\definition.txt.

_______________________________________________________________________________
18.05.2004 10:22:25 Версия 2.1.0
СЕРВЕР:
+ Серверный сокет.
+ Возможность получать команды (от клиента, через telnet) через сокет.
+ Формирование ответов на запросы cqml.
- Информация в Главном меню, теперь core: getinfo.
- results.ini.
- убрал из ини logdir, signalslogdir, calibrarcdir.

ЯДРО:
+ pid - номер родительской точки контроля для класса вагонов.

КЛИЕНТ:
+ Клиентский сокет.
+ Возможность отправлять команды серверу через сокеты.
+ Панель индикации сигналов работает через cqml-запросы к серверу.
- убрал из ини logdir, signalslogdir, calibrarcdir.
* После получения клиентских данных от сервера: заменяем '_' на пробелы и
  ищем для каждой точки контроля vid.

CQML:
+ Язык запросов к МКУ Серверу.
+ Получение клиенских данных от сервера (getclientdata).
+ Возможность рестарта и выключения сервера и его машины через команды off.
+ Возможность запуска команд ОС, команда cmd.
+ Команда ? и core: ?.
+ Команда core: getsigval.

_______________________________________________________________________________
08.05.04 08:49:45 Версия stable-2.0.10
СЕРВЕР:
+ Возможность repair-восстановления таблиц при старте.
+ Часы.
+ Сплэш-форма при загруке.

КЛИЕНТ:
* Нормальное положение окон при 800*600.
* !"Внутрення" вместо "Внутреняя".
* Цвета и размеры элементов в отчётах.
+ Настройка интервалов зольности для рабочих графиков зольности.
+ Сплэш-форма при загруке.

_______________________________________________________________________________
07.04.04 10:42:26 Версия 2.0.9
СЕРВЕР:
+ Flush tables после работы с ядром и запись новых значений в бд.
+ Новый splash-screen (ProMKU).
+ Пароль для работы с Сервером: 31415dd, где dd - ДВЕ цифры даты
  текущего месяца.
+ Буферизация журнальных сообщений от ядра.

ЯДРО:
+ Новый класс точки контроля 3, работает как простой только имеет анализ
  питателя для конвейера.
* Баг в новом класса СПК;( = вместо == в if(...)).
* Неактивный сигнал (умолчание) не инвертируется.

КЛИЕНТ:
* Сортировка в редакторе вагонов как в обозревателе (viewer`e) по moment, id.
* Если Помощник неактивен - убираем его пункт из главного меню.
* Баг с Итого в отчёте по позициям.

_______________________________________________________________________________
13.03.04 12:52:10 Версия 2.0.8.
СЕРВЕР:
+ Пароль для работы с сервером.
+ Всплывающее меню на TrayIcon, для возможности завершения работы сервера
  без знания пароля.
+ Возможность поправить зольность в минутном архиве ;).
+ Возможность поправить зольность в вагонах ;).
+ Печать заголовка сигналов в файле с архивом сигналов.
+ Проверка целостности базы данных в StartActions.

ЯДРО: Версия 1.0.2.
+ Возможность давать команды ядру через вызов core.execute(char*).
  Команды: ssd <signal> - сделать сигнал неактивным, по умолчанию;
           ssa <signal> - сделать сигнал активным.
           sdv <signal> <value> - задать значение сигнала по умолчанию.
* Имена питателей для точки контроля 102 задаются из points.cqm,
  что бы не зависеть от имён сигналов.
+ Проверка неработы питателей для определения пустого конвейера.
  Для этого имена сигналов от питателей задаются явно для каждого
  класса в points.cqm.
+ Добавлен новый класс точек контроля для way4@stash, way5@stash, который
  анализирует 4 питателя.
+ Установка новых значений SaP и jaP для всех градуировок.
+ Класс вагонов 1 для samara. (с крыльями текущий/следующий).
* При первом тике значение частотного сигнала равно defaultvalue.
* Коррекция частоты при девиации интервалов времени (тиков).
* Нагляднее формат сообщений ядра.

КЛИЕНТ:
+ Возможность печати удостоверения на чистом листе и на бланке.
* В отчёте по позициям не было всех позиций за месяц. Теперь есть.

УТИЛИТА:
+ Плоттер csv-файлов.


_______________________________________________________________________________
23.02.04 12:00:17 Версия 2.0.7.
СЕРВЕР:

ЯДРО: Версия 1.0.1.
* Баг в определении новых коэффициентов b,c.
  Для определения c использовали уже новое значение b.
* В пересчёте пределов мог менятся только один предел.
  Теперь или два (всё ок), или ни одного (при рассчёте хотя бы одного
  произошла ошибка).
* Зольность не может быть 0. Или NULL, или то, что посчитали по формуле.
* Ошибка в СПК.

БАЗА ДАННЫХ:

КЛИЕНТ:
+ Добавил отметки зольности вагонов на графике из отчётов.
  Работает также как на графиках рабочего окна.
* В помощнике оператора теперь ищет только зольность not null and a>0.
+ Изменил дизайн рабочих графиков.

УТИЛИТА:
+ Возможность построить график из csv-файла (сигналы, калибр. архив).

_______________________________________________________________________________
19.02.04 16:17:50 Версия 2.0.6.
СЕРВЕР:
+ В Расчёте коэффициентов нагрузки по весам вагонов добавлен выбор интервала
  времени от и до, вместо выбора количества последних дней.
+ В Расчёте коэффициентов нагрузки по весам вагонов добавлено значение
  Fp = FpP при котором P = 0. Значение FpP вводится руками.
* В Расчёте коэффициентов нагрузки по весам вагонов забыл
  взять логарифм от FpF. Получается чушь, но правильная:)

ЯДРО: Версия 1.0.0 (релиз).
* При установке значения град. файла изменялось только значение в таблице БД;
  теперь изменяется и в map calibration. Нужно что бы после MakeLimits
  работали новые коеффициенты и пределы.
+ При появлении нового значения FaП сдвиг уравнения происходит по
  горизонтали на значение dFaP, которое рассчитывается в MakeAA
  и устанавливается для всех градуировок;
  новые значения b,c расчитываются для каждой градуировки при ее активности
  в MakeLimits если dFaP>0 и после dFaP=0.

БАЗА ДАННЫХ:
* Поставил тип поля points.moment как
  moment datetime NOT NULL вместо timestamp, что бы при правке значений
  из таблицы в сервере не изменялась установленная дата.

КЛИЕНТ:
* Маленькие бока в отчётах.
* Формирование времени в суточном отчёте нужно HH:MM.
+ Добавил отметки зольности вагонов на графики рабочего положения.
  Что бы знать с какого пути показывать на какую точку контроля показывать,
  в клиентских данных ввел для точки контроля int vid - номер
  отгрузки вагонов. Эта зольность не может быть скользящей,
  только оригинал.
+ На графике зольности интервал времени больше на одну минуту, что бы было
  видно маркер последнего вагона.
* В ини нельзы было поставить visible=0 для индикатора сигналов.
  MDIChild нельзя Hide. Теперь в ини параметр vis и он делает
  Enbale=0.
+ Окно "Помощник оператора загрузки". Конфигурируется из ини.

УТИЛИТА:
+ Добавлена в проект утилита cqmutil, которая делает:
    1. Очистку старых журналов и архивов сигналов.
    2. Упаковку базы данных. Заменяет записи за час на одну с суммарным весом и
       зольностью за регулируемый интервал времени.
  Можно запускать с GUI и выполнить нужную последовательность действий
  заданием параметров в коммандной строке.
* В модуле fdm.cpp для воэможности использования
  функции DoMsg объявил её как extern вместо включения заголовочного файла.

_______________________________________________________________________________
11.02.04 15:29:57 Версия 2.0.5.
СЕРВЕР:
+ Реализована защита от копирования сервера путем привязки ПО к винчестеру.
  Генерирует ключи из серийного номера винта программа KeyGen.

ЯДРО:

КЛИЕНТ:

_______________________________________________________________________________
09.02.04 10:46:21 Версия 2.0.4.
СЕРВЕР:
+ Работает проверка наличия питания. В ини добавил:
___
[power]
;нужно ли проверять наличие питания
checkpower=1
;Имя сигнала от питания
powersignalname=power
;команда для отключения
offcommand="d:\\projects\\off\\off"
___
В конфигурации в/в должен быть сигнал power, который подключен к питанию
и говорит о его наличии. В sys положил утилиту off, которая может выключать и
перезагружать комп.

ЯДРО: Версия 0.9.9.
Баг в MakeP1. Нужно проверять на неноль сумму mp+mpR и сумму
соответствующих частот.

Баг в CqmVagon::Make. Для определения диагностики "не простой" нужно:
if (!(P->diag & D_IDLE)) вместо if (!(P->diag && D_IDLE)). УУУ!

При добавлении угля в вагон ложу теперь не просто p,a;
ложу именно coal, у которого м.б. p=NULL и a=NULL. Это важно для вагона.

Отслеживаю исключения во время выполнения Compute::Make.

Если P = NULL, то ставлю все mp* и Fp* равными нулю.
Для однозначности.

Диагностируется и обрыв, и источник в БДН при простое (как в БДЗ).

При простое анализируем сигналы дл вагонов в CqmVagon::Make.
Раньше анализ был только для непростойных минут.

В CoalHeap::Add при расччёте средневзвешенной золы проверяем не равно ли
сумма p1 и p2 нулю. Если да, то вес оставляем 0, а золу принимаем равной
среднеарифметической.

Если приходит к нормальной куче p!=0 и a==0, то вес увеличивает, а золу
осавляет ту же. Раньше считало среднеарифметически.

КЛИЕНТ:
При объединении вагонов с p1 = p2 = 0 и известной золой было деление на ноль.
Это был баг в CoalHeap::AddCoal. Исправил.

_______________________________________________________________________________
04.02.04 12:02:07 Версия 2.0.3.
СЕРВЕР:
Пункт меню Сервер -> Методисту ->Расчёт коэффициентов нагрузки по весам вагонов
считает по методу наименьших квадратов коэффициенты нагрузки alpha и beta,
зная для каждого вагона lnFp, mp, wei(ВЕС).

Пункт меню Сервер -> Методисту -> Сохранить градуировочный файл на диск
сохраняет текущий град. файл в файл carc\grad_yyyy_mm_dd_hh_nn.txt,
все точки контроля, типы углей и параметры.

Убрал окно часов.

ЯДРО: Версия 0.9.8.
В методе CqmAlgorithm::MakeLimits (определение предельных частот
для зольности) проверяем на a=0.
Если да, то сообщение в журнал и метод не выполняется.

У класса ControlPoint новый метод - void Complete(void);
Вызывается из Compute::Make после points[i]->Make() для
исполнения дествий после работы алгоритма.

Если градуировочный параметр BDP равен нулю,
то алгоритм(!) считает что P = NULL.

КЛИЕНТ:
Значение зольности на рабочих окнах с графиками:
пусто, если NULL или <2;
нет данных, если не найдена минута в таблице.
_______________________________________________________________________________
03.02.04 11:18:36 Версия 2.0.2.1.
СЕРВЕР:
Пункт меню Сервер -> Информация, который выводит информацию
о ядре и сервере в журнал, но не в лог сервера!

ЯДРО:
Новая функция-член core
void get_info(char *info); //выводит инфу об ядре в строку

_______________________________________________________________________________
02.02.04 18:28:34 Версия 2.0.2.0.
ЯДРО: Версия 0.9.7
Добавлена поддержка нового устройства ввода/вывода a10.
Соответствующие устройства:
DEVICE_A10_DISCRETE_IN      130
DEVICE_A10_COUNTERS_IN      66
Сигналы:
SIGNAL_FREQ_A10             67

_______________________________________________________________________________
02.02.04 12:22:03 Версия 2.0.1.2.
CЕРВЕР:
Записи в журнал о КВ и игнорирование КВ теперь производятся
только если debug=1.

КЛИЕНТ:
Изменил размеры шрифтов в удостоверении для печати
на матричном принтере.

_______________________________________________________________________________
31.01.04 12:40:07 Версия 2.0.1.0.
СЕРВЕР:
Класс точки контроля 102:
Регулируется время задержки между питателями и золомером.
В файле points.cqm последний параметр
для строки с описанием точки класса 102 ставим задержку в минутах.

Для вагонов со смешанным типов угля ставим тип 0 - тип по умолчанию.

КЛИЕНТ:
Убрал окно, которое спрашивает: Запускать сервер?
Проверка, запущен ли сервер, происходит при старте и каждую минуту
в функции RefreshActions() без диалога.

ИНСТАЛЛЯЦИЯ:
Инсталляционная программа разрещается на части для переписывания на дискеты
утилиткой partfile.

При инсталяции выполняется добавлеие
ежедневного назначенного задание резервирование базы данных:
at 00:10 c:\mku\backup\makedbbackup.bat

Автоматичекское обновление ПО.

Группа программ МКУ с пунктами:
МКУ Сервер
МКУ Клиент
МКУ Резервирование
МКУ Обновление
Деинсталляция МКУ

Мелкие исправления.


_______________________________________________________________________________
29.01.04 17:18:53 Версия 2.0.0 (Релиз).
СЕРВЕР:
Ядро версии 0.9.6.
Интерфейс ядра:
  void io_read(void);                         //2-сек. действие, чтение в/в.
  void io_load_start(char* conffilename);     //стартовое действие, загрузка
                                                конфигурации в/в.
  void io_stop_clear(void);                   //стоповое действие, закрытие
                                                конфигурации в/в.
  void compute_load_start(char* conffilename);//стартовое действие, загрузка
                                                конфигурации расчёта.
  void compute_stop_clear(void);              //стоповое действие, закрытие
                                                конфигурации расчёта.
  void io_2_compute(void);                    //2-сек. действие, сохранение
                                                значений сигналов после в/в для
                                                дальнейших рассчётов.
  void compute_make(void);                    //непосредственно, расчёт.

Поддерживаемы устройства и их функции:
DEVICE_PCL836_DISCRETE_IN - pcl836 / дискретный ввод;
DEVICE_PCL836_COUNTERS_IN - pcl836 / счётчики входной частоты.

Поддерживаемы сигналы:
SIGNAL_DISCRETE - Дискретный входной сигнал;
SIGNAL_FREQ_836 - Частотный входной сигнал на pcl836.

Поддерживаемые методы обработки сиганлов:
METHOD_WAS_0 - хотя бы один ноль =0;
METHOD_WAS_1 - хотя бы один один =1;
METHOD_MAJOR - больше нулей =0, больше единиц =1.

Поддерживаемые классы алгоритмов:
CQM_POINT     - общий (Сташкова);
CQM_POINT_102 - (Путь 4 на ГОФ "Красная Звезда").

Поддерживаемы классы повагонного контроля:
CQM_VAGON - общий (Сташкова).

Ввод/вывод:
драйвер win.io;
интерфейс с ним через класс TWinPort.

Окна:
Сигналы, Точки Контроля, Вагоны, Градиуровка, Журнал.
Не обновляются автоматически.

Сервер базы данных:
MySql 3.23.58-nt

Настройка через ini:
  титульное название комплекса
  имя файла с логами (журнал);
  имена файлов генерируются в зависимости от времени их создания в формате
name_YYYY_MM_DD_HH_MM_SS.log;
  куда ложить логи;
  куда ложить csv-файлы с сигналами;
  куда ложить град. архив;
  тик нити ввода/вывода;
  таймаут остановки нити в/в;
  таймаут разделения времени доступа к core;
  нужно ли обновлять таблицы после coreactions;
  файл с конфигурацией ввода/вывода;
  файл с конфигурацией точек контроля;
  файл с результатами анализа сигналов;
  параметры соединения с сервером БД.


КЛИЕНТ:
Настройка через ini:
  конфигурации системы (точки контроля и системы повагонного контроля,
аналог point.cqm для сервера);
  титульное название комплекса;
  имя файла с логами (журнал);
  куда ложить логи;
  нужно проверять запущен ли сервер;
  путь к серверу;
  путь к файлу с результатми анализа сигналов для индикации;
  путь к шаблону с лицевой стороной удостоверения;
  параметры соединения с сервером БД;
  настройка панели индикации (размещение, выбор сигналов);
  положения окон:
    графики;
    просмотры вагонов;
    редакторы вагонов;

Отчёты
  суточный;
  повагонный;
  по позициям;
  поминутный;
  удостоверение;
  график.

ИНСТАЛЛЯТОР
работает.


_______________________________________________________________________________
  +  добавлена новая фича;
  -  удалена фича;
  !  обнаружен баг;
  *  устранён баг.
